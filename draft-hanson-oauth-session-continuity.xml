<?xml version="1.0" encoding="UTF-8"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc2629 version 1.6.2 (Ruby 2.6.8) -->


<!DOCTYPE rfc  [
  <!ENTITY nbsp    "&#160;">
  <!ENTITY zwsp   "&#8203;">
  <!ENTITY nbhy   "&#8209;">
  <!ENTITY wj     "&#8288;">

<!ENTITY RFC6749 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6749.xml">
<!ENTITY RFC2119 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC8174 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8174.xml">
<!ENTITY RFC7519 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7519.xml">
<!ENTITY RFC9068 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.9068.xml">
<!ENTITY I-D.wdenniss-oauth-device-posture SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.wdenniss-oauth-device-posture.xml">
<!ENTITY RFC7662 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7662.xml">
]>


<rfc ipr="trust200902" docName="draft-hanson-oauth-session-continuity-latest" category="std" consensus="true" submissionType="IETF">
  <front>
    <title>OAuth 2.0 Session Continuity</title>

    <author initials="J." surname="Hanson" fullname="Jared Hanson">
      <organization>Okta</organization>
      <address>
        <email>jared.hanson@okta.com</email>
      </address>
    </author>
    <author initials="K." surname="McGuinness" fullname="Karl McGuinness">
      <organization>Okta</organization>
      <address>
        <email>kmcguinness@okta.com</email>
      </address>
    </author>

    <date year="2022" month="March" day="16"/>

    <area>Security</area>
    <workgroup>Web Authorization Protocol</workgroup>
    

    <abstract>


<t>This specification defines a mechanism by which an OAuth 2.0 authorization
server can maintain a logical authorization session in which protected resources
can be accessed over a period time.  This specification also extends existing
OAuth 2.0 endpoints so that dynamic context about the session, such as user
location or device health, can be communicated to the authorization server
throughout the lifetime of the session.  Combined, this functionality provides
a lightweight approach to continuous authorization.</t>



    </abstract>



  </front>

  <middle>


<section anchor="introduction"><name>Introduction</name>

<t>In OAuth 2.0 <xref target="RFC6749"/>, an authorization server issues an access token and
refresh token to a client.  The client uses the access token to access protected
resources hosted by a resource server, and uses the refresh token to obtain
access tokens from the authorization server.  While the authorization server,
client, and resource server are separate entities, the usage of the access token
and refresh token forms a logical authorization session shared between each
entity.</t>

<t>The access token and refresh token are issued by the authorization server after
authenticating the resource owner and obtaining authorization.  Authorization is
typically obtained by interacting with the resource owner via the authorization
endpoint.  Once authorization has been obtained, issuance of the tokens
initiates an ongoing session in which protected resources may be accessed over
a period of hours or even days.</t>

<t>During this time, the status of the resource owner and her device, such as role,
location, or security posture, may change.  Increasingly, access to protected
resources needs to be based on this dynamically changing context.  However,
typical OAuth deployments evaluate this context infrequently - often only at
session initiation.</t>

<t>This specification provides mechanisms by which an OAuth deployment can both
increase the frequency of access policy evaluation during a session, as well as
increase awareness of dynamically changing context about the session used to
inform policy decisions.  Combined, this functionality provides a lightweight
approach to continuous authorization.</t>

<section anchor="client-profiles"><name>Client Profiles</name>

<t>This specification has been designed around the client profiles defined in
Section 2.1 of <xref target="RFC6749"/>:</t>

<dl newline="true">
  <dt>web application:</dt>
  <dd>
    <t>A web application is a confidential client running on a web server.  Resource
owners access the client via an HTML user interface rendered in a user-agent on
the device used by the resource owner.  The client credentials as well as any
access token issued to the client are stored on the web server and are not
exposed to or accessible by the resource owner.</t>
  </dd>
  <dt>user-agent-based application:</dt>
  <dd>
    <t>A user-agent-based application is a public client in which the client code is
downloaded from a web server and executes within a user-agent (e.g., web
browser) on the device used by the resource owner.  Protocol data and
credentials are easily accessible (and often visible) to the resource owner.
Since such applications reside within the user-agent, they can make seamless use
of the user-agent capabilities when requesting authorization.</t>
  </dd>
  <dt>native application:</dt>
  <dd>
    <t>A native application is a public client installed and executed on the device
used by the resource owner.  Protocol data and credentials are accessible to the
resource owner.  It is assumed that any client authentication credentials
included in the application can be extracted.  On the other hand, dynamically
issued credentials such as access tokens or refresh tokens can receive an
acceptable level of protection.  At a minimum, these credentials are protected
from hostile servers with which the application may interact.  On some
platforms, these credentials might be protected from other applications residing
on the same device.</t>
  </dd>
</dl>

</section>
<section anchor="token-locality"><name>Token Locality</name>

<t>After obtaining approval of the end-user via interaction within the end-user's
user-agent, OAuth issues delegation-specific access tokens and refresh tokens to
clients.  This specification defines two token localities, based on where tokens
reside relative to the user-agent in which the issuance was approved:</t>

<dl newline="true">
  <dt>off device:</dt>
  <dd>
    <t>A token is off device when it resides with an application that is not located
on the same device as the end-user's user-agent.  Tokens issued to a web
application are off device, as the application runs on a web server acceessed
remotely via the user-agent.</t>
  </dd>
  <dt>on device:</dt>
  <dd>
    <t>A token is on device when it resides with an application that is located on
the same device as the end-user's user-agent.  Tokens issued to native
native applications and user-agent-based applications are on device, as the
application is executing either on the device or within the user-agent itself.</t>
  </dd>
</dl>

</section>
<section anchor="notational-conventions"><name>Notational Conventions</name>

<t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
"MAY", and "OPTIONAL" in this document are to be interpreted as
described in BCPÂ 14 <xref target="RFC2119"/> <xref target="RFC8174"/> when, and only when, they
appear in all capitals, as shown here.</t>

</section>
</section>
<section anchor="json-web-token-claims"><name>JSON Web Token Claims</name>

<t>Access tokens and refresh tokens are opaque, and can have different formats,
structures, and methods of utilization based on resource server and
authorization server security requirements.  Although the mechanisms described
herein can be used with any type of token, this section defines claims to
express such semantics specifically for JSON Web Token (JWT) <xref target="RFC7519"/>.
Similar definitions for other types of tokens are possible but beyond the scope
of this specification.</t>

<section anchor="access-tokens"><name>Access Tokens</name>

<t>JSON Web Token Profile for OAuth 2.0 Access Tokens <xref target="RFC9068"/> defines a
profile for issuing OAuth 2.0 access tokens in JSON Web Token (JWT) format.
OAuth 2.0 deployments implementing this specification SHOULD issue access
tokens in conformance that profile.</t>

<t>The following additional claims MAY be included to facilitate session
continuity.</t>

<t>sid  OPTIONAL - As defined in Section 3 of OpenID.FrontChannel.</t>

</section>
</section>
<section anchor="signal-sharing"><name>Signal Sharing</name>

<section anchor="refreshing-an-access-token"><name>Refreshing an Access Token</name>

<section anchor="from-on-device"><name>From On Device</name>

<t>A native application possessing a refresh token that is on device shares signals
by making a refresh request that includes device posture, as defined in section
6 of <xref target="I-D.wdenniss-oauth-device-posture"/>.</t>

<t>For example, the client makes the following HTTP request using transport-layer
security (with extra line breaks for display purposes only):</t>

<figure><artwork><![CDATA[
  POST /token HTTP/1.1
  Host: server.example.com
  Content-Type: application/x-www-form-urlencoded

  grant_type=refresh_token&refresh_token=tGzv3JOkF0XG5Qx2TlKWIA
  client_id=s6BhdRkqt3&device_posture=%7B%22screen_lock%22%3Atrue%2C
  %22device_os%22%3A%22iOS%22%2C%22device_os_version%22%3A%2211.1%22
  %7D
]]></artwork></figure>

</section>
<section anchor="from-off-device"><name>From Off Device</name>

<t>A web application posessing a refresh token that is off device shares signals by
making a refresh request that includes user-agent posture, as defined by User
Agent Posture Signals.</t>

<t>For example, the client makes the following HTTP request using transport-layer
security (with extra line breaks for display purposes only):</t>

<figure><artwork><![CDATA[
  POST /token HTTP/1.1
  Host: server.example.com
  Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW
  Content-Type: application/x-www-form-urlencoded

  grant_type=refresh_token&refresh_token=tGzv3JOkF0XG5Qx2TlKWIA
  client_id=s6BhdRkqt3&user_agent_posture=%7B%22user_agent%22%3A%22Mozilla%2F5.0
  %20%28Macintosh%3B%20Intel%20Mac%20OS%20X%2010_14_5%29%20AppleWebKit%2F537.36
  %20%28KHTML%2C%20like%20Gecko%29%20Chrome%2F75.0.3770.142%20Safari%2F537.36%22
  %2C%22ip_address%22%3A%2293.184.216.34%22%7D
]]></artwork></figure>

<t>The client MUST only include user-agent posture in online access scenarios.
Refresh tokens used in offline scenarios, when the end-user is not present, are
decoupled from the session and lack end-user user agent context.</t>

</section>
</section>
<section anchor="token-introspection"><name>Token Introspection</name>

<section anchor="introspection-request"><name>Introspection Request</name>

<t>A resource server querying for to determine the state of an access token shares
signals by making an by making an introspection request to the introspection
endpoint, as defined in Section 2.1 of <xref target="RFC7662"/>.</t>

<t>In addition to the parameters defined by Section 2.1 of <xref target="RFC7662"/>, the
following parameters are also defined:</t>

<dl>
  <dt>user_agent_posture</dt>
  <dd>
    <t>OPTIONAL. URL-encoded JSON dictionary, containing user-agent posture signals,
as defined by User Agent Posture Signals.</t>
  </dd>
</dl>

<t>For example, the client makes the following HTTP request using transport-layer
security (with extra line breaks for display purposes only):</t>

<figure><artwork><![CDATA[
  POST /introspect HTTP/1.1
  Host: server.example.com
  Accept: application/json
  Content-Type: application/x-www-form-urlencoded
  Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW

  token=mF_9.B5f-4.1JqM&token_type_hint=access_token
  &user_agent_posture=%7B%22user_agent%22%3A%22Mozilla%2F5.0
  %20%28Macintosh%3B%20Intel%20Mac%20OS%20X%2010_14_5%29%20AppleWebKit%2F537.36
  %20%28KHTML%2C%20like%20Gecko%29%20Chrome%2F75.0.3770.142%20Safari%2F537.36%22
  %2C%22ip_address%22%3A%2293.184.216.34%22%7D
]]></artwork></figure>

<t>Note that the locality of an access token is always off device when presented to
a resource server.</t>

</section>
</section>
</section>
<section anchor="comparison-to-caep"><name>Comparison to CAEP</name>

<t>Use of existing endpoints is
intended to provide a lightweight approach to continuous authorization, while
complimenting future protocols that provide real-time access evaluation using a
publish-subscribe approach.</t>

</section>


  </middle>

  <back>

    <references title='Normative References'>

&RFC6749;
&RFC2119;
&RFC8174;
&RFC7519;
&RFC9068;
&I-D.wdenniss-oauth-device-posture;
&RFC7662;


    </references>




  </back>

<!-- ##markdown-source:
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
By0mAAA=

-->

</rfc>

